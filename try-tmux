#!/bin/bash

# try-tmux: Create experiment directory with try and start tmux session
# Usage: try-tmux <experiment-name> [additional-try-args...]

set -e

# Check if try is installed
if ! command -v try >/dev/null 2>&1; then
  echo "Error: 'try' command not found" >&2
  echo "" >&2
  echo "Please install 'try' first:" >&2
  echo "  gem install try-cli" >&2
  echo "  # or" >&2
  echo "  cargo install try-cli" >&2
  echo "  # or" >&2
  echo "  brew tap tobi/try https://github.com/tobi/try" >&2
  echo "  brew install try" >&2
  echo "" >&2
  echo "Then add to your shell config:" >&2
  echo "  eval \"\$(try init)\"" >&2
  exit 1
fi

# Check if tmux-session is available
TMUX_SESSION_CMD=""
if command -v tmux-session >/dev/null 2>&1; then
  TMUX_SESSION_CMD="tmux-session"
elif [[ -x "./tmux-session" ]]; then
  TMUX_SESSION_CMD="./tmux-session"
else
  echo "Error: 'tmux-session' command not found" >&2
  echo "Please ensure tmux-session is in your PATH or current directory" >&2
  exit 1
fi

# Run try with all arguments
try "$@"

# Start tmux session in the directory try moved us to
"$TMUX_SESSION_CMD" .
